{% extends "base.html" %} {% block content %}
<div class="container my-4">
  {% if user.is_authenticated %}
  <div class="mb-3">
    <a href="{% url 'cars:car_add' %}" class="btn btn-success">Добавить авто</a>
  </div>
  {% endif %}

  <form id="filter-form" class="row g-2 mb-4">
    <div class="col-md-3">
      <input type="text" name="q" class="form-control" placeholder="Поиск..." />
    </div>
    <div class="col-md-2">
      <select name="brand" class="form-select">
        <option value="">Все бренды</option>
        {% for b in brands %}
        <option value="{{ b.id }}">{{ b.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <input
        type="number"
        name="price_min"
        class="form-control"
        placeholder="Цена от"
      />
    </div>
    <div class="col-md-2">
      <input
        type="number"
        name="price_max"
        class="form-control"
        placeholder="Цена до"
      />
    </div>
    <div class="col-md-1">
      <input
        type="number"
        name="year_min"
        class="form-control"
        placeholder="Год от"
      />
    </div>
    <div class="col-md-1">
      <input
        type="number"
        name="year_max"
        class="form-control"
        placeholder="Год до"
      />
    </div>
    <div class="col-md-1 d-grid">
      <button type="submit" class="btn btn-primary">Найти</button>
    </div>
    <div class="col-md-1 d-grid">
      <button type="reset" class="btn btn-outline-secondary" id="reset-btn">
        Сброс
      </button>
    </div>
  </form>

  <div id="cars-container" class="row g-3"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('filter-form');
    const container = document.getElementById('cars-container');

    function loadCars(params = '') {
      fetch("{% url 'cars:car_filter' %}?" + params)
        .then((res) => res.text())
        .then((html) => {
          container.innerHTML = html;
          container.querySelectorAll('.ajax-page').forEach((link) => {
            link.addEventListener('click', function (e) {
              e.preventDefault();
              loadCars(new URL(this.href).searchParams.toString());
            });
          });
        });
    }

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      const params = new URLSearchParams(new FormData(form)).toString();
      loadCars(params);
    });

    document.getElementById('reset-btn').addEventListener('click', function () {
      form.reset();
      loadCars();
    });

    loadCars();
  });
</script>
{% endblock %}
